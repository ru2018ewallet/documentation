digraph {
  rankdir="LR"
  newrank="true"

#// personalize: generate keys
  
  empty -> pre
  pre -> use [label="T(M):personalize()"]

  use -> lock [label="lock()\n\n"]
  use -> use [label="balance()"]
  use -> use [label="T(C):history()"]
  use -> use [label="T(P):pay()"]
  use -> use [label="T(C):charge()"]

  lock -> lock [label="T(M):history()"]
  lock -> lock [label="T(M):balance()"]
  lock -> die [label="T(M):kill()"]

  empty [color="#a6a6a6"]
  pre [color="#0033cc",penwidth=3]
  use [color="#0033cc",penwidth=3]
  lock [color="#cc0000",penwidth=3]
  die [color="#cc0000",penwidth=3]

  subgraph cluster_0 {
    label="OS completed"
    rank="same"
    rankdir="TB"
    empty
  }

  subgraph cluster_1 {
    label="initialized\npre-personalization"
    rank="same"
    rankdir="TB"
    pre
  }

  subgraph cluster_2 {
    label="personalized"
    rank="same"
    rankdir="TB"
    use
    lock
  }

  subgraph cluster_3 {
    label="end-of-life"
    rank="same"
    rankdir="TB"
    die
  }

}